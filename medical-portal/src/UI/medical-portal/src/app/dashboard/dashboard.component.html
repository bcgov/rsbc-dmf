<div class="page-desc">
  <div class="container">
    <img
      src="assets/images/u541.svg"
      alt="Dashboard-icon"
      class="dashboard-icon"
    />
    <h1>Welcome to the new<br />Medical Practitioner Portal</h1>
    <p>
      The portal will allow you to easily find, fill out and submit a driver
      medical examination report (DMER) to RoadSafetyBC.
    </p>
    <p>
      Upon submission, RoadSafetyBC will review the information and if they have
      subsequent questions or require extra information they will message you.
      To ensure privacy and security, you will get an email letting you know
      that you have a message waiting in this portal.
    </p>
  </div>
</div>

<div class="container" style="margin-top: 20px">
  <div style="width: 90%; margin-left: auto; margin-right: auto">
    <div
      class="bc-gov-alertbanner bc-gov-alertbanner-warning"
      role="alert"
      aria-labelledby="warning"
      aria-describedby="warning-desc"
    >
      <p id="warning-desc">
        RoadsafetyBC has requested more information for one of your DMERs.

        <a href="#" style="text-decoration: underline">See my messages</a>
      </p>
    </div>
  </div>
</div>

<div class="container">
  <mat-card class="search">
    <mat-card-header class="primary">
      <mat-card-title
        ><i class="fas fa-search"></i> Search DMER Case</mat-card-title
      >
    </mat-card-header>
    <mat-card-content>
      <form>
        <div>
          <label class="form-label">DMER Case ID</label><br />

          <mat-form-field class="search-input" appearance="outline">
            <mat-label>Enter DMER case ID</mat-label>
            <input
              matInput
              placeholder=" "
              [(ngModel)]="searchBox"
              [ngModelOptions]="{ standalone: true }"
            />
          </mat-form-field>
        </div>

        <button
          mat-flat-button
          color="primary"
          class="search-button"
          (click)="search()"
        >
          Search DMER Case
        </button>
      </form>
    </mat-card-content>
  </mat-card>

  <div class="list">
    <h2>Your DMERs</h2>
    <p>
      Quickly access the DMERs you have worked on. Use the filter option to
      better define what youâ€™re looking for.
    </p>

    <div>
      <mat-form-field class="cases-input" appearance="outline">
        <input
          matInput
          type="text"
          placeholder="Search By Name or Case Id"
          [(ngModel)]="searchCasesInput"
        />
        <button
          matSuffix
          mat-icon-button
          aria-label="search"
          (click)="searchCases()"
        >
          <mat-icon>search</mat-icon>
        </button>
      </mat-form-field>

      <mat-icon class="filter-icon">filter_alt</mat-icon>
      <mat-label style="color: #003366">Filter By: </mat-label>
      <mat-form-field appearance="outline" class="cases-filter">
        <mat-select
          [(ngModel)]="selectedStatus"
          (selectionChange)="onStatusChanged()"
        >
          <mat-option *ngFor="let status of statuses" [value]="status.label">
            {{ status.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <button mat-button (click)="clear()">Clear</button>
    </div>
  </div>
  <div>
    <ng-container *ngIf="!isLoading">
      <ng-container *ngIf="totalRecords > 0; else noData">
        <table
          mat-table
          #formsList
          matSort
          (matSortChange)="sortData($event)"
          [dataSource]="sortedData"
          matSortActive="title"
          matSortDirection="asc"
          matSortDisableClear
        >
          <ng-container matColumnDef="title">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header="title"
              sortActionDescription="Sort by DMER Case ID"
            >
              DMER Case ID
            </th>
            <td mat-cell *matCellDef="let row">
              <a
                [routerLink]="['/cases/case', row.id]"
                routerLinkActive="router-link-active"
              >
                {{ row.title }}
              </a>
            </td>
          </ng-container>
          <ng-container matColumnDef="patientName">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header="patientName"
              sortActionDescription="Sort by Patient's Name"
            >
              Patient's Name
            </th>
            <td mat-cell *matCellDef="let row">{{ row.patientName }}</td>
          </ng-container>
          <ng-container matColumnDef="lastUpdatedOn">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header="modifiedOn"
              sortActionDescription="Sort by Last Date Modified"
            >
              Last Date Modified
            </th>
            <td mat-cell *matCellDef="let row">{{ row.modifiedOn | date }}</td>
          </ng-container>
          <ng-container matColumnDef="clinicName">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header="clinicName"
              sortActionDescription="Sort by Clinic Name"
            >
              Clinic Name
            </th>
            <td mat-cell *matCellDef="let row">{{ row.clinicName }}</td>
          </ng-container>
          <ng-container matColumnDef="status">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header="status"
              sortActionDescription="Sort by Status"
            >
              Status
            </th>
            <td mat-cell *matCellDef="let row">{{ row.status }}</td>
          </ng-container>

          <tr
            mat-header-row
            *matHeaderRowDef="[
              'title',
              'patientName',
              'lastUpdatedOn',
              'clinicName',
              'status'
            ]"
          ></tr>
          <tr
            mat-row
            *matRowDef="
              let row;
              columns: [
                'title',
                'patientName',
                'lastUpdatedOn',
                'clinicName',
                'status'
              ]
            "
          ></tr>
        </table>

        <div class="table-actions">
          <p>
            Showing
            {{
              pageNumber * pageSize > totalRecords
                ? totalRecords
                : pageNumber * pageSize
            }}
            of {{ totalRecords }} records
          </p>
          <a style="cursor: pointer" (click)="loadRecords()"
            >View more records<mat-icon>arrow_drop_down</mat-icon>
          </a>
        </div>
      </ng-container>

      <ng-template #noData> No Records Found </ng-template>
    </ng-container>
  </div>
</div>
